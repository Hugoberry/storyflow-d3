<!DOCTYPE html>
<html>
<head lang="en">
	<meta charset="UTF-8">
	<title>StoryFlow: Tracking the Evolution of Stories</title>
	<script type="text/javascript" src="d3/d3.v3.js"></script>
</head>
<body>
	<script type="text/javascript">
		// http://stackoverflow.com/questions/9838812/how-can-i-open-a-json-file-in-javascript-without-jquery
		function load_json(path, success, error)
		{
			var xhr = new XMLHttpRequest();

			xhr.onreadystatechange = function()
			{
				if (xhr.readyState === XMLHttpRequest.DONE) {
					if (xhr.status === 200) {
						if (success)
							success(JSON.parse(xhr.responseText));
					} else {
						if (error)
							error(xhr);
					}
				}
			};

			xhr.open("GET", path, true);
			xhr.send();
		}

		load_json("dataset/star_wars.json", function(dataset) {
			var annotateDataset = function (dataset) {
				var levels = [0, dataset.sessions[0].end];
 				dataset.sessions[0].level = 1;
 				for(var i = 1; i < dataset.sessions.length; i++){
					j = 1;
					var inserted = 0;
					while(j < levels.length && inserted == 0){
						if(dataset.sessions[i].start > levels[j]){
							dataset.sessions[i].level = j;
							inserted = 1;
							levels[j] = dataset.sessions[i].end;
						}
						else j++;
					}
					if(inserted == 0){
						dataset.sessions[i].level = j;
						levels.push(dataset.sessions[i].end);
					}
				}
				console.log(levels.length);
				return dataset;
 			}
			
			var plotDataset = function(dataset) {

			};

			// plotDataset(annotateDataset(dataset));
			console.log(annotateDataset(dataset));
		}, null);
	</script>
</body>
</html>